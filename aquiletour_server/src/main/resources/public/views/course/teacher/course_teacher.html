<div class="mt-3 courses-container">

<<<<<<< HEAD
  
  <ol id="breadcrumb" class="breadcrumb" style="margin-left:30px; margin-bottom: 0px;">
    <li id="bc-position" class="breadcrumb-item" siblings='[{"id": "3C6"}, {"id": "4Z6"}]'><a href="#">4F5</a></li>
    <li class="breadcrumb-item" siblings='[{"id":"Etape 2"},{"id":"Etape 3"}]'><a href="#">Étape 1</a></li>
    <li class="breadcrumb-item" siblings='[{"id": "Examen"}, {"id": "Projets"}]'><a href="#">Travaux pratiques</a></li>
    <li class="breadcrumb-item" siblings=null><a href="#">TP1</a></li>
    
  </ol>
    <canvas id="breadcrumbs-container">
      
    </canvas>
    
  


  <div class="mt-3 flex-container" id="tasks-container">

    <div> 
      <div class='card border mb-3'>
          <div class='card-header bg-transparent border'>
              <span id="task-name">TP1</span><span style="float:right;">4 avril</span>
          </div>
          <div class='card-body text'>
              <div>Tâches préalables:</div>
              <div class='card-footer bg-transparent border'>
                  <ul>
                    <li><input type="checkbox"/><a href="#">atelier 1</a> ✓
                    <li><input type="checkbox"/><a href="#">bonus</a> ☆
                  </ul>
              </div>
              <span style="float:right;">⊞</span>

              <br>

              <div>Sous-tâches:</div>
              <div class='card-footer bg-transparent border'>
                  <ul>
                    <li><input type="checkbox"/>  <a href="#">créer la vue</a> ✓
                    <li><input type="checkbox"/><a href="#">créer le modèle</a> ☆
                    <li><input type="checkbox"/><a href="#">créer un test</a> ☆
                  </ul>
              </div>
              <span style="float:right;">⊞</span>

              <br>

              <div>Tâches suivantes:</div>
              <div class='card-footer bg-transparent border'>
                  <ul>
                      <li><a href="#">TP2</a>
                      <li><a href="#">préparer examen 1</a>
                  </ul>
              </div>
              <span style="float:right;">⊞</span>
          </div>
      </div>
      
      
      <div class="progressbar">
        <div class="progressbar-bar"></div>
        <div class="progressbar-label"></div>
      </div>
      <div class="ready"></div>
    </div>

    <div class='card border mb-3'>
        <div class='card-header bg-transparent border'>
            <span id="task-name">TP2</span><span style="float:right;">18 avril</span>
        </div>
        <div class='card-body text'>
            <div>Tâches préalables:</div>
            <div class='card-footer bg-transparent border'>
                <ul>
                    <li><a href="#">TP1</a> ✓
                </ul>
            </div>
            <span style="float:right;">⊞</span>

            <br>

            <div>Sous-tâches:</div>
            <div class='card-footer bg-transparent border'>
                <ul>
                    <li><a href="#">créer la vue</a> ✓
                    <li><a href="#">créer le modèle</a> ✓
                    <li><a href="#">créer un test</a> ✓
                </ul>
            </div>
            <span style="float:right;">⊞</span>

            <br>

            <div>Tâches suivantes:</div>
            <div class='card-footer bg-transparent border'>
                <ul>
                    <li><a href="#">préparer examen 1</a>
                    <li><a href="#">atelier 4</a>
                </ul>
            </div>
            <span style="float:right;">⊞</span>
        </div>
    </div>
=======
  <div class="mt-3" style="margin-left:30px;">
      <nav aria-label="breadcrumb">
      <ol class="breadcrumb breadcrumbs-ol" id="breadcrumbs-container">
      </ol>
      </nav>
  </div>

  <div class="mt-3 flex-container" id="tasks-container">
>>>>>>> main
  </div>

  <div class="mt-3 d-flex justify-content-center">
    <button class="btn-primary btn-add-course" 
            type="button" 
            id="add-task-button" 
            data-toggle="modal" 
            data-target="#add-task-modal">Ajouter une tâche</button>
  </div>

  <div class="modal fade" id="add-task-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content dashboard-mContent">
        <div class="modal-header">
          <h5 class="modal-title">Ajouter une tâche</h5>
          <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
        </div>
        
        <div class="modal-body dashboard-mBody">
          <form action="" method="post" class="add-course-form">
            <input name="taskId" id="task-id-input" style="display:none;"></input>
            <label for="title">Titre de la nouvelle tâche:</label>
            <input name="newSubTask" id="new-subtask-input"></input>
            <div class="modal-footer border-0">         
              <button class="btn btn-primary" id="add-subtask-submit-button">Ajouter</button>  
              <button type="button" class="btn btn-secondary" data-dismiss="modal" id="close-modal-button">Annuler</button>          
            </div>  
          </form>
        </div>       
      </div>
    </div>
  </div>






</div>

<script type="text/javascript" src="/_R/js/fabric.min.js"></script>

<script>

  var canvas = new fabric.Canvas('breadcrumbs-container');
  var radius = 8;
  var diameter = radius * 2;
  
  var breadcrumb = $("#breadcrumb");
  var margin = parseInt(breadcrumb.css("marginLeft"));

  canvas.setWidth((breadcrumb.outerWidth() + margin));
  canvas.setHeight(100);

  function testCircle(index ,top, left, radius){
    var circle = new fabric.Circle({
    top: top,
    left: left,
    strokeWidth: 3,
    radius: radius,
    fill: 'black',
    stroke: 'white',
    selectable: false,
    id: index
    });

    return circle;
  }

  function getPosition(element) {
    var xPos = 0;
    var yPos = 0;

    while (element) {
      if (element.tagName == "BODY") {
        var xScroll = element.scrollLeft || document.documentElement.scrollLeft;
        var yScroll = element.scrollTop || document.documentElement.scrollTop;

        xPos += (element.offsetLeft - xScroll + element.clientLeft);
        yPos += (element.offsetTop - yScroll + element.clientTop);
      } else {
        xPos += (element.offsetLeft - element.scrollLeft + element.clientLeft);
        yPos += (element.offsetTop - element.scrollTop + element.clientTop);
      }
      
      element = element.offsetParent;
    }
    return {
      x: xPos,
      y: yPos
    };
  }

 document.addEventListener('load', updatePosition());
 
  function makeLine(coords) {
    return new fabric.Line(coords,{
      fill: 'orange',
      stroke: 'orange',
      strokeWidth: 5,
      selectable: false,
      evented: false
    });
  }

  
  function updatePosition() {
    var bcItems = $(".breadcrumb-item");
    var myElement = document.querySelector("#bc-position"); 
    var position = getPosition(myElement);

    
    
    canvas.clear();

    //console.log(bcItems);

    bcItems.each(( index, element ) => {
      console.log(element, getPosition(element), index);
      

      
      var offsetY = element.offsetTop - (element.offsetTop - 1);
      var centerY = element.offsetTop + (element.offsetHeight / 2) - radius;
      var centerX = element.offsetLeft + (element.offsetWidth / 2) - radius;
      var offsetRight = window.innerWidth - element.offsetLeft - element.offsetWidth;

      let jsonValue = $(bcItems[index]).attr("siblings");
      let parsedJson = JSON.parse(jsonValue);


      console.log("offset top: " + centerY + " offset left: " + offsetRight);

      canvas.add(makeLine([element.offsetLeft, radius, offsetRight, radius]), testCircle(index, offsetY, centerX, radius));
      

      if (parsedJson.length != 0 && parsedJson.length > 0) {

        canvas.add(testCircle(index, offsetY + (diameter + radius), centerX, radius));

      } else {
        
      }
  
      console.log( "json object : " + JSON.stringify(parsedJson));
      
      
      
    });
    
    

    

    canvas.on('mouse:over', function(e) {
      
      if (e.target != null) {
        
        if (parsedJson.length != 0 && parsedJson.length > 0) {
          console.log("has siblings");
        } else {
          console.log("no siblings");
        }

      }

      
    });
    
  }

$(document).ready(function() {
  
  // get box count
  var count = 0;
  var checked = 0;
  function countBoxes() { 
    count = $("input[type='checkbox']").length;
    console.log(count);
  }
  
  countBoxes();
  $(":checkbox").click(countBoxes);
  
  // count checks
  
  function countChecked() {
    checked = $("input:checked").length;
    
    var percentage = parseInt(((checked / count) * 100),10);
    $(".progressbar-bar").progressbar({
            value: percentage
        });
    $(".progressbar-label").text(percentage + "%");
    
  }
  
  countChecked();
  $(":checkbox").click(countChecked);
});

</script>
